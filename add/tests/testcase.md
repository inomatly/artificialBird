
# 仕様

※単体テスト仕様と設計上の仕様を兼任するメモとする。

## テスト化しない仕様

- 送信機の機能は，ボタン読み込み（上下左右に対応する4つ）と送信（赤外線LEDのOUTPUT, 10個のLED全てで共通の信号を送信）とする。
- 受信機の機能は，受信，モータ制御（サーボモータは制御2つ分，直流モータ制御1つ）とする。
- ~~GPIOのOUTPUTのON-OFF，toggleは，IDEが生成する，ドライバーに相当するマクロ関数を使用する。~~
- 直流モータの制御はトランジスタによる電気式スイッチへPWMで送ることとし，直流モータは電源から直接動力を得るとする。

## テスト化する仕様(受信機)

- 周期OOでセンサ値を読み込む(タイマ割り込み)。
- 過去10回のセンサ値を，配列として先入先出で保持する。
- モータ制御信号を解析し，モータ設定値変数を更新する。
- モータ設定値変数を元に，常にモータに指令信号を送り続ける。（ポーリング処理）
- モータのうち，サーボモータはPWM制御で角度を制御することとする。
- モータのうち，直流モータはPWM制御で電圧を制御することとする。


### LEDドライバ

- ~~LEDがON-OFFできる。~~
- ~~入力によりON, OFF, TOGGLEを操作できる。~~
- タイマ割り込み周期に合わせて信号のONOFFを更新する

### モータードライブ

#### 済

#### 未

- ~~timerを利用し，GPIOで疑似的にPWMを生成する。タイマの割り込み周期と，出力の識別子を入力にする。~~
- ~~PWMで出力する（LED）~~

- LED用の出力と，DcMorot用出力と，Servo1用出力と，Servo2用出力の4種類がある。PWMは，enumで定義する識別子で出力先を選択可能

- PWMでDCモーターを制御する。
- PWMでサーボモータを制御する。
- 受信信号を元に，モータ制御用のパラメータを更新
- モータ制御用のパラメータを元にモータを制御する。常に回し続ける。

- タイマ割り込みで光らせながら，PWMの調査
- 受信の動作試験

- 回路作成

- 結合
    - ~~LEDで可視光で，タイマ割り込み1Sとかで実装してみる。~~
- ch1~終端信号まで終わったら，UpdateSignalRowで配列を更新する。たしか未実装のはず。

- アソシエイト



## memo (開発の手順)

1. v6のMPLABでMCCで設定し，データを生成する。
2. テストのパスに追加する。
3. v5のMPLABでMCCで追加されたデータをフォルダに追加する。

## 動作確認その他やること

- 数式をまとめる(本)
- ~~サーボの動作確認~~
- ~~トランジスタを介す制御~~
    - ~~DCはトランジスタでOK~~
    - ~~サーボは電源が別にあるので，直でOK.~~
- ~~電流の確認~~
- ~~フォトトランジスタの確認~~
    - ~~持ってない~~
    - ~~とりあえず回路的には単純なので設計してみる。多分どうにかなる。~~
- ~~回路図作成~~
- ~~KiCADデータの作成~~
- ~~サーボモータの動作試験~~
    - ~~仕様の確認~~
    - ~~トランジスタをかませる~~
    - ~~回路図に反映~~
- ~~DCモータの動作試験~~

- 送信機の作成
- 受信ユニットの作成
- 重量測定

- PWMの波形を見て再現　→ 保留！
